(function(){"use strict";let r=null;self.addEventListener("message",i=>{const{__rpcId:c,action:l,payload:f}=i.data??{},u=(t,n,s)=>{self.postMessage({__rpcId:c,ok:t,result:n,error:s})};try{if(l==="setData"){r=f.data,u(!0,{length:r?.length},null);return}if(l==="filterMap"){if(!r){u(!1,null,"No data set");return}const{predicate:t,map:n}=f,s=[],o=e=>t?.type==="keyEq"?e[t.key]===t.val:t?.type==="gte"?e[t.key]>=t.val:t?.type==="custom"?!!new Function("obj",t.fnBody)(e):!0,p=e=>n?n.type==="pickKey"?e[n.key]:n.type==="custom"?new Function("obj",n.fnBody)(e):e:e;for(let e=0;e<r.length;e++){const a=r[e];o(a)&&s.push(p(a))}u(!0,{result:s},null);return}if(l==="getLength"){u(!0,{length:r?.length??0},null);return}u(!1,null,`Unknown action ${l}`)}catch(t){u(!1,null,String(t))}})})();
