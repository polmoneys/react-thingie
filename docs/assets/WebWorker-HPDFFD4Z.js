import{r as i,j as d,a as h,F as R}from"./index-D9xIr4Uz.js";import{f as W}from"./intl-DyjOi7tP.js";const k="WORKER_TERMINATED";function T(e="Worker terminated"){const f=new Error(e);return f.code=k,f}function x(e,f){const v=i.useRef(0),r=i.useRef(new Map),l=i.useRef(e);i.useEffect(()=>{if(l.current=e,!e)return;const t=n=>{const a=n.data??{},{__rpcId:c,ok:s,result:g,error:p}=a;if(typeof c!="number")return;const o=r.current.get(c);o&&(r.current.delete(c),o.timer&&clearTimeout(o.timer),s?o.resolve(g):o.reject(new Error(String(p))))},u=n=>{r.current.forEach(({reject:a,timer:c})=>{c&&clearTimeout(c);const s=new Error(`Worker error: ${n.message}`);s.code=k,a(s)}),r.current.clear()};return e.addEventListener("message",t),e.addEventListener("error",u),()=>{e.removeEventListener("message",t),e.removeEventListener("error",u),r.current.forEach(({reject:n,timer:a})=>{a&&clearTimeout(a),n(T("Listener removed"))}),r.current.clear()}},[e,!1]);const m=i.useCallback((t,u,n,a)=>{const c=l.current;if(!c)return Promise.reject(new Error("No worker provided"));const s=++v.current;return new Promise((g,p)=>{const o={resolve:g,reject:p};if(typeof a=="number"&&a>0){const w=window.setTimeout(()=>{r.current.delete(s),p(new Error("RPC timeout"))},a);o.timer=w}r.current.set(s,o);try{c.postMessage({__rpcId:s,action:t,payload:u},n??[])}catch(w){r.current.delete(s),o.timer&&clearTimeout(o.timer),p(w)}})},[]);function E(){const t=l.current;r.current.forEach(({reject:u,timer:n})=>{n&&clearTimeout(n),u(T())}),r.current.clear(),t&&t.terminate(),l.current=null}return{call:m,terminate:E}}const j=[{id:1,name:"Alice",age:25,active:!0},{id:2,name:"Bob",age:30,active:!1},{id:3,name:"Charlie",age:22,active:!0},{id:4,name:"Diana",age:35,active:!0},{id:5,name:"Eve",age:28,active:!1},{id:6,name:"Frank",age:40,active:!0},{id:7,name:"Grace",age:19,active:!0},{id:8,name:"Hank",age:50,active:!1},{id:9,name:"Ivy",age:29,active:!0},{id:10,name:"Jack",age:33,active:!1}];function _({items:e=j}){const[f,y]=i.useState(null),[v,r]=i.useState([]),l=i.useMemo(()=>new Worker(new URL("/react-thingie/assets/web-worker-compute-array-C-rVXGsP.js",import.meta.url),{type:"module"}),[]),m=x(l);return i.useEffect(()=>{let E=!1;return(async()=>{try{await m.call("setData",{data:e},void 0,5e3);const t=await m.call("filterMap",{predicate:{type:"keyEq",key:"active",val:!0},map:{type:"pickKey",key:"name"}},void 0,5e3);if(E)return;r(t.result.slice(0,10));const u=await m.call("getLength",void 0,void 0,2e3);if(E)return;y(u.length)}catch(t){if(t?.code==="WORKER_TERMINATED")return;console.warn("Worker error",t)}})(),()=>{E=!0}},[m,e]),d.jsxs(d.Fragment,{children:[d.jsxs(h,{mood:"positive",children:[d.jsxs(R.Bold,{children:["Worker data length: ",f??"..."]}),d.jsxs(R,{children:["Sample names: ",W(new Set(v))]})]}),d.jsx("br",{})]})}export{j as ITEMS,_ as default};
