import{r as i,j as w,a as h,F as R}from"./index-CM369WM3.js";import{f as W}from"./intl-DyjOi7tP.js";const k="WORKER_TERMINATED";function T(e="Worker terminated"){const d=new Error(e);return d.code=k,d}function I(e,d){const p=i.useRef(0),r=i.useRef(new Map),l=i.useRef(e);i.useEffect(()=>{if(l.current=e,!e)return;const t=n=>{const a=n.data??{},{__rpcId:c,ok:s,result:v,error:E}=a;if(typeof c!="number")return;const o=r.current.get(c);o&&(r.current.delete(c),o.timer&&clearTimeout(o.timer),s?o.resolve(v):o.reject(new Error(String(E))))},u=n=>{r.current.forEach(({reject:a,timer:c})=>{c&&clearTimeout(c);const s=new Error(`Worker error: ${n.message}`);s.code=k,a(s)}),r.current.clear()};return e.addEventListener("message",t),e.addEventListener("error",u),()=>{e.removeEventListener("message",t),e.removeEventListener("error",u),r.current.forEach(({reject:n,timer:a})=>{a&&clearTimeout(a),n(T("Listener removed"))}),r.current.clear()}},[e,!1]);const m=i.useCallback((t,u,n,a)=>{const c=l.current;if(!c)return Promise.reject(new Error("No worker provided"));const s=++p.current;return new Promise((v,E)=>{const o={resolve:v,reject:E};if(typeof a=="number"&&a>0){const g=window.setTimeout(()=>{r.current.delete(s),E(new Error("RPC timeout"))},a);o.timer=g}r.current.set(s,o);try{c.postMessage({__rpcId:s,action:t,payload:u},n??[])}catch(g){r.current.delete(s),o.timer&&clearTimeout(o.timer),E(g)}})},[]);function f(){const t=l.current;r.current.forEach(({reject:u,timer:n})=>{n&&clearTimeout(n),u(T())}),r.current.clear(),t&&t.terminate(),l.current=null}return{call:m,terminate:f}}const S=[{id:1,name:"Alice",age:25,active:!0},{id:2,name:"Bob",age:30,active:!1},{id:3,name:"Charlie",age:22,active:!0},{id:4,name:"Diana",age:35,active:!0},{id:5,name:"Eve",age:28,active:!1},{id:6,name:"Frank",age:40,active:!0},{id:7,name:"Grace",age:19,active:!0},{id:8,name:"Hank",age:50,active:!1},{id:9,name:"Ivy",age:29,active:!0},{id:10,name:"Jack",age:33,active:!1}];function D({items:e=S}){const[d,y]=i.useState(null),[p,r]=i.useState([]),l=i.useMemo(()=>new Worker(new URL("/react-thingie/assets/web-worker-compute-array-C-rVXGsP.js",import.meta.url),{type:"module"}),[]),m=I(l);return i.useEffect(()=>{let f=!1;return(async()=>{try{await m.call("setData",{data:e},void 0,5e3);const t=await m.call("filterMap",{predicate:{type:"keyEq",key:"active",val:!0},map:{type:"pickKey",key:"name"}},void 0,5e3);if(f)return;r(t.result.slice(0,10));const u=await m.call("getLength",void 0,void 0,2e3);if(f)return;y(u.length)}catch(t){if(t?.code==="WORKER_TERMINATED")return;console.warn("Worker error",t)}})(),()=>{f=!0}},[m,e]),w.jsxs(h,{mood:"positive",children:[w.jsxs(R.Bold,{children:["Worker data length: ",d??"..."]}),w.jsxs(R,{children:["Sample names: ",W(new Set(p))]})]})}export{S as ITEMS,D as default};
