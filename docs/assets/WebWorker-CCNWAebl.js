import{r as y,j as s,T as F,I as w,l as H,B as R,G as U,F as E,a as M}from"./index-CLMjQahV.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const O=Symbol("Comlink.proxy"),G=Symbol("Comlink.endpoint"),_=Symbol("Comlink.releaseProxy"),T=Symbol("Comlink.finalizer"),j=Symbol("Comlink.thrown"),z=e=>typeof e=="object"&&e!==null||typeof e=="function",B={canHandle:e=>z(e)&&e[O],serialize(e){const{port1:t,port2:r}=new MessageChannel;return L(e,t),[r,[r]]},deserialize(e){return e.start(),I(e)}},V={canHandle:e=>z(e)&&j in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},N=new Map([["proxy",B],["throw",V]]);function q(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function L(e,t=globalThis,r=["*"]){t.addEventListener("message",function f(a){if(!a||!a.data)return;if(!q(r,a.origin)){console.warn(`Invalid origin '${a.origin}' for comlink proxy`);return}const{id:n,type:g,path:c}=Object.assign({path:[]},a.data),l=(a.data.argumentList||[]).map(x);let o;try{const i=c.slice(0,-1).reduce((u,h)=>u[h],e),d=c.reduce((u,h)=>u[h],e);switch(g){case"GET":o=d;break;case"SET":i[c.slice(-1)[0]]=x(a.data.value),o=!0;break;case"APPLY":o=d.apply(i,l);break;case"CONSTRUCT":{const u=new d(...l);o=K(u)}break;case"ENDPOINT":{const{port1:u,port2:h}=new MessageChannel;L(e,h),o=J(u,[u])}break;case"RELEASE":o=void 0;break;default:return}}catch(i){o={value:i,[j]:0}}Promise.resolve(o).catch(i=>({value:i,[j]:0})).then(i=>{const[d,u]=P(i);t.postMessage(Object.assign(Object.assign({},d),{id:n}),u),g==="RELEASE"&&(t.removeEventListener("message",f),v(t),T in e&&typeof e[T]=="function"&&e[T]())}).catch(i=>{const[d,u]=P({value:new TypeError("Unserializable return value"),[j]:0});t.postMessage(Object.assign(Object.assign({},d),{id:n}),u)})}),t.start&&t.start()}function X(e){return e.constructor.name==="MessagePort"}function v(e){X(e)&&e.close()}function I(e,t){const r=new Map;return e.addEventListener("message",function(a){const{data:n}=a;if(!n||!n.id)return;const g=r.get(n.id);if(g)try{g(n)}finally{r.delete(n.id)}}),C(e,r,[],t)}function b(e){if(e)throw new Error("Proxy has been released and is not useable")}function W(e){return p(e,new Map,{type:"RELEASE"}).then(()=>{v(e)})}const S=new WeakMap,k="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(S.get(e)||0)-1;S.set(e,t),t===0&&W(e)});function Q(e,t){const r=(S.get(t)||0)+1;S.set(t,r),k&&k.register(e,t,e)}function Y(e){k&&k.unregister(e)}function C(e,t,r=[],f=function(){}){let a=!1;const n=new Proxy(f,{get(g,c){if(b(a),c===_)return()=>{Y(n),W(e),t.clear(),a=!0};if(c==="then"){if(r.length===0)return{then:()=>n};const l=p(e,t,{type:"GET",path:r.map(o=>o.toString())}).then(x);return l.then.bind(l)}return C(e,t,[...r,c])},set(g,c,l){b(a);const[o,i]=P(l);return p(e,t,{type:"SET",path:[...r,c].map(d=>d.toString()),value:o},i).then(x)},apply(g,c,l){b(a);const o=r[r.length-1];if(o===G)return p(e,t,{type:"ENDPOINT"}).then(x);if(o==="bind")return C(e,t,r.slice(0,-1));const[i,d]=A(l);return p(e,t,{type:"APPLY",path:r.map(u=>u.toString()),argumentList:i},d).then(x)},construct(g,c){b(a);const[l,o]=A(c);return p(e,t,{type:"CONSTRUCT",path:r.map(i=>i.toString()),argumentList:l},o).then(x)}});return Q(n,e),n}function $(e){return Array.prototype.concat.apply([],e)}function A(e){const t=e.map(P);return[t.map(r=>r[0]),$(t.map(r=>r[1]))]}const D=new WeakMap;function J(e,t){return D.set(e,t),e}function K(e){return Object.assign(e,{[O]:!0})}function P(e){for(const[t,r]of N)if(r.canHandle(e)){const[f,a]=r.serialize(e);return[{type:"HANDLER",name:t,value:f},a]}return[{type:"RAW",value:e},D.get(e)||[]]}function x(e){switch(e.type){case"HANDLER":return N.get(e.name).deserialize(e.value);case"RAW":return e.value}}function p(e,t,r,f){return new Promise(a=>{const n=Z();t.set(n,a),e.start&&e.start(),e.postMessage(Object.assign({id:n},r),f)})}function Z(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function te(){const e=y.useMemo(()=>new Worker(new URL("/react-thingie/assets/qr.worker-B6hXhRpR.js",import.meta.url),{type:"module"}),[]),[t,r]=y.useState("https://polmoneys.com"),[f,a]=y.useState(null),[n,g]=y.useState(!1),[c,l]=y.useState(null),[o,i]=y.useState(!1),d=y.useMemo(()=>I(e),[e]);y.useEffect(()=>()=>{try{console.log("Dev mode"),e.terminate(),i(!0)}catch{}},[e]);const u=async()=>{a(null),l(null),g(!0);try{const m=await d.generateSvg(t);a(m)}catch(m){l(m?.message??String(m))}finally{g(!1)}},h=async()=>{a(null),l(null),g(!0);try{const m=await d.generateDataUrl(t);a(m)}catch(m){l(m?.message??String(m))}finally{g(!1)}};return s.jsxs(s.Fragment,{children:[s.jsx(F,{id:"qr-input",label:s.jsx(w.Info,{size:32}),value:t,onChange:m=>r(m),gridTemplateColumns:"44px 1fr"}),s.jsx("br",{}),s.jsxs(H,{label:"Actions",dangerous:{gap:"var(--gap-1)"},children:[s.jsx(R.Positive,{isPending:n,...!n&&{start:s.jsx(w.Add,{size:22})},onClick:u,children:n?"Generating…":"SVG"}),s.jsx(R.Positive,{isPending:n,...!n&&{start:s.jsx(w.Add,{size:22})},onClick:h,children:n?"Generating…":"PNG DataURL"}),s.jsx(R.Negative,{start:s.jsx(w.X,{size:22}),onClick:()=>{e.terminate(),i(!0)},children:"Terminate worker"})]}),s.jsx("br",{}),s.jsxs(U.Col,{className:"theme info",dangerous:{minHeight:"200px",placeContent:"center",placeItems:"center"},children:[n&&s.jsx(w.LoadingBar,{}),!n&&f&&(f.startsWith("data:")?s.jsx("img",{src:f,alt:"QR"}):s.jsx("div",{dangerouslySetInnerHTML:{__html:f}})),!n&&!f&&!c&&s.jsx(E.Bold,{children:"No QR generated yet."})]}),s.jsx("br",{}),c&&s.jsxs(M,{mood:"negative",children:[s.jsx(E.Bold,{children:"Error:"})," ",s.jsx(E,{children:c})]}),s.jsx("br",{}),s.jsx(M,{mood:o?"negative":"info",children:s.jsxs(E.Bold,{children:["Worker status: ",o?"OFF":"ON"]})})]})}export{te as default};
